<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FUTUROS</title>
    <link rel="stylesheet" href="assets/style.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="shared.js"></script>
</head>
<body>
    <div id="auth-container" style="display: none; text-align: center; padding: 50px;">
        <h1>FUTUROS</h1>
        <p>You need admin access to view this page.</p>
        <p>Please check your email for a magic link or contact the administrator.</p>
    </div>

    <div id="admin-container" class="admin-container" style="display: none;">
        <div class="admin-header">
            <h1>FUTUROS</h1>
        </div>

        <!-- First Vote Statistics Panel -->
        <div class="admin-panel">
            <h2>Primeiro voto</h2>
            <div class="vote-stats">
                <div class="vote-count">
                    <div class="count" id="firstLeftVoteCount">0</div>
                    <div>"Rodar o teste final e ir para casa"</div>
                </div>
                <div class="vote-count">
                    <div class="count" id="firstRightVoteCount">0</div>
                    <div>"Tomar um café e continuar trabalhando"</div>
                </div>
            </div>
        </div>

        <!-- Second Vote Statistics Panel -->
        <div class="admin-panel">
            <h2>Segundo voto</h2>
            <div class="vote-stats">
                <div class="vote-count">
                    <div class="count" id="secondLeftVoteCount">0</div>
                    <div>"Tentar desligar o sistema"</div>
                </div>
                <div class="vote-count">
                    <div class="count" id="secondRightVoteCount">0</div>
                    <div>"Tentar se comunicar com a IA"</div>
                </div>
            </div>
        </div>

        <!-- Events Log Panel -->
        <div class="admin-panel">
            <h2>Log de eventos</h2>
            <div class="log-container" id="peerLog">
                <div class="log-entry">
                    <span class="timestamp">[00:00:00]</span>
                    <span>Sistema inicializado. Aguardando conexões...</span>
                </div>
            </div>
        </div>
    </div>

    <footer>
        &copy; 2025 Futuros
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            // Check if user is authenticated
            const { data: { session } } = await supabase.auth.getSession();

            // Check if user has a valid session and is authenticated with email
            if (session && session.user && session.user.email) {
                // Show admin content
                document.getElementById('admin-container').style.display = 'block';
                document.getElementById('auth-container').style.display = 'none';

                // Update footer with user info
                updateFooterWithUserInfo(session.user);
            } else {
                // Show auth message
                document.getElementById('admin-container').style.display = 'none';
                document.getElementById('auth-container').style.display = 'block';
            }

            // Handle auth state changes
            supabase.auth.onAuthStateChange((event, session) => {
                if (event === 'SIGNED_IN' && session && session.user && session.user.email) {
                    // Show admin content when signed in
                    document.getElementById('admin-container').style.display = 'block';
                    document.getElementById('auth-container').style.display = 'none';

                    // Update footer with user info
                    updateFooterWithUserInfo(session.user);
                } else if (event === 'SIGNED_OUT') {
                    // Hide admin content when signed out
                    document.getElementById('admin-container').style.display = 'none';
                    document.getElementById('auth-container').style.display = 'block';
                }
            });
        });
    </script>
</body>
</html>
